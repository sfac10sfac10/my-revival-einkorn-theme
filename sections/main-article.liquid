{{ 'section-blog-post.css' | asset_url | stylesheet_tag }}

{%- style -%}
  /* ===== Scoped styles for this section ===== */
  .section-{{ section.id }}-pad {
    padding-top: {{ section.settings.padding_top | default: 36 | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | default: 36 | times: 0.75 | round: 0 }}px;
    margin-inline: 10px;
  }
  .blog-post__header {
    margin-top: -40px !important;
  }
  .blog-post__header h1 {
    font-size: 28px;
  }
  .blog-post__header .article-{{ section.id }}__date {
    font-size: 14px;
    font-weight:300;
  }
  @media (min-width: 750px){
    .section-{{ section.id }}-pad {
      padding-top: {{ section.settings.padding_top | default: 36 }}px;
      padding-bottom: {{ section.settings.padding_bottom | default: 36 }}px;
    }
    .blog-post__header {
      margin-top: -20px !important;
    }
    .blog-post__header h1 {
      font-size: 48px;
    }
  }

  @media (min-width: 990px){
    .section-{{ section.id }}-pad {
      width: 90%;
      margin-inline: auto;
      padding-inline: 0;
    }
  }

  /* Hero image: rounded corners + natural ratio */
  .article-{{ section.id }}__hero {
    border-radius: 12px; overflow: hidden;
  }
  .article-{{ section.id }}__hero img { width: 100%; height: auto; display: block; }

  /* Any images inside content keep natural ratio and rounded corners */
  .page-width .article-template__content.rte img {
    max-width: 100%; height: auto; border-radius: 12px;
  }
  .article-template__content a { text-decoration: none;}

  /* Two-column layout (main + aside) for ≥750px */
  .article-{{ section.id }}__layout { display: grid; gap: 32px; }
  .article-{{ section.id }}__aside { display: none; }
  @media (min-width: 750px){
    .article-{{ section.id }}__layout {
      grid-template-columns: minmax(0, 1fr) var(--aside-w, {{ section.settings.aside_width_percent | default: 28 }}%);
      align-items: start;
    }
    .article-{{ section.id }}__aside { display: block; }
  }

  /* Title + date to match reference weight/spacing */
  .article-{{ section.id }}__title { font-weight: 800; line-height: 1.15; margin: 0 0 10px; }
  .article-{{ section.id }}__date { margin: 10px 0 22px; color: rgba(0,0,0,.65); font-weight: 600; }

  /* Share block inside main column */
  .article-{{ section.id }}__share-title { font-weight: 700; letter-spacing: .08em; margin: 26px 0 10px; }
  .article-{{ section.id }}__share-wrap { margin-bottom: 6px; }

  /* Recent articles (aside) */
  .article-{{ section.id }}__aside-title { font-size: 20px; font-weight: 700; margin: 0 0 12px; }
  .article-{{ section.id }}__aside-list { list-style: none; padding: 0; margin: 0; display: grid; gap: 20px; }
  .article-{{ section.id }}__aside-item { border-top: 1px solid #e6e6e6; padding-top: 16px; }
  .article-{{ section.id }}__aside-link { color: rgb(55,55,55); text-decoration: none; }
  .article-{{ section.id }}__aside-link:hover { text-decoration: underline; }
  .article-{{ section.id }}__aside-date { display: block; margin-top: 6px; color: rgba(0,0,0,.6); font-size: .9em; }

  /* Print button + pager */
  .article-{{ section.id }}__print .button {
    border-radius: 12px;
    margin-top: 12px;
    --border-offset: 0;          /* neutralize outer ring */
    --buttons-border-offset: 0;  /* some Dawn versions use this var */
  }

  .article-{{ section.id }}__print .button,
  .article-{{ section.id }}__print .button:hover,
  .article-{{ section.id }}__print .button:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  .article-{{ section.id }}__print .button::before,
  .article-{{ section.id }}__print .button::after {
    box-shadow: none !important;
    border: 0 !important;
  }

  .article-{{ section.id }}__pager {
    display: flex; justify-content: space-between; align-items: center;
    border-top: 1px solid #e6e6e6; margin-top: 30px; padding-top: 16px;
  }
  .article-{{ section.id }}__pager a { font-weight: 600; text-decoration: none; color: #373737;}
  .article-{{ section.id }}__pager a:hover { text-decoration: none; }
  .article-{{ section.id }}__pager svg { vertical-align: middle; margin-bottom: 2px;}

  /* Print stylesheet: hide UI bits when printing */
  @media print{
    .header-wrapper, .section-header, .footer,
    .article-{{ section.id }}__aside, .article-{{ section.id }}__pager,
    .article-{{ section.id }}__share-wrap, .article-{{ section.id }}__print { display: none !important; }
  }

  .article-{{ section.id }}__share-icons { display:flex; gap:20px; align-items:center; }
  .article-{{ section.id }}__share-icons a { color: inherit; text-decoration: none; }
  .article-{{ section.id }}__share-icons a:hover { text-decoration: underline; }
  .article-{{ section.id }}__share-icons .svg-wrapper svg,
  .article-{{ section.id }}__share-icons img.share-custom-icon { width: 22px; height: 22px; display:block; }
{%- endstyle -%}

{%- assign aside_enabled = section.settings.aside_enabled -%}
{%- assign aside_count = section.settings.aside_count | default: 4 -%}

{%- if aside_enabled -%}
  {%- capture recent_aside -%}
    <aside class="article-{{ section.id }}__aside" aria-labelledby="recent-{{ section.id }}">
      <h3 id="recent-{{ section.id }}" class="article-{{ section.id }}__aside-title">
        {{ section.settings.aside_title | default: 'Recent articles' }}
      </h3>
      <ul class="article-{{ section.id }}__aside-list" role="list">
        {%- assign shown = 0 -%}
        {%- for a in blog.articles -%}
          <li class="article-{{ section.id }}__aside-item">
            <a class="article-{{ section.id }}__aside-link" href="{{ a.url }}">{{ a.title }}</a>
            <span class="article-{{ section.id }}__aside-date">{{ a.published_at | time_tag: format: 'date' }}</span>
          </li>
          {%- assign shown = shown | plus: 1 -%}
          {%- if shown >= aside_count -%}{% break %}{%- endif -%}
        {%- endfor -%}
      </ul>
    </aside>
  {%- endcapture -%}
{%- endif -%}

{% assign content_block = section.blocks | where: 'type', 'content' | first %}
{% assign share_block = section.blocks | where: 'type', 'share' | first %}

<article class="article-template section-{{ section.id }}-pad">
  {%- comment -%} FEATURED IMAGE (rounded, natural ratio) {%- endcomment -%}
  {% assign hero_html = '' %}
  {% assign header_html = '' %}
  {%- for block in section.blocks -%}
    {%- case block.type -%}
      {%- when '@app' -%}
        <div class="page-width">
          {% render block %}
        </div>
      {%- when 'featured_image' -%}
        {%- if article.image -%}
          {% capture hero_html %}
            <div class="article-template__hero-container" {{ block.shopify_attributes }}>
              <div
                class="article-template__hero-{{ block.settings.image_height }} media article-{{ section.id }}__hero"
                {% if block.settings.image_height == 'adapt' and article.image %}
                  style="padding-bottom: {{ 1 | divided_by: article.image.aspect_ratio | times: 100 }}%;"
                {% endif %}
              >
                <img
                  srcset="
                    {% if article.image.width >= 350 %}{{ article.image | image_url: width: 350 }} 350w,{% endif %}
                    {% if article.image.width >= 750 %}{{ article.image | image_url: width: 750 }} 750w,{% endif %}
                    {% if article.image.width >= 1100 %}{{ article.image | image_url: width: 1100 }} 1100w,{% endif %}
                    {% if article.image.width >= 1500 %}{{ article.image | image_url: width: 1500 }} 1500w,{% endif %}
                    {% if article.image.width >= 2200 %}{{ article.image | image_url: width: 2200 }} 2200w,{% endif %}
                    {% if article.image.width >= 3000 %}{{ article.image | image_url: width: 3000 }} 3000w,{% endif %}
                    {{ article.image | image_url }} {{ article.image.width }}w
                  "
                  sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 }}px, (min-width: 750px) calc(100vw - 10rem), 100vw"
                  src="{{ article.image | image_url: width: 1100 }}"
                  loading="eager"
                  fetchpriority="high"
                  width="{{ article.image.width }}"
                  height="{{ article.image.height }}"
                  alt="{{ article.image.alt | escape }}"
                >
              </div>
            </div>
          {% endcapture %}
        {%- endif -%}

      {%- when 'title' -%}
        {% capture header_html %}
          <header class="blog-post__header" {{ block.shopify_attributes }}>
            <h1 class="article-template__title article-{{ section.id }}__title">{{ article.title | escape }}</h1>
            {%- if block.settings.blog_show_date -%}
              <div class="article-{{ section.id }}__date">
                {{- article.published_at | time_tag: format: 'date' -}}
              </div>
            {%- endif -%}
            {%- if block.settings.blog_show_author -%}
              <span class="caption-with-letter-spacing">
                <span>{{ article.author }}</span>
              </span>
            {%- endif -%}
          </header>
        {% endcapture %}
    {%- endcase -%}
  {%- endfor -%}

  <!-- Combined content + share + aside layout (placed after the blocks loop) -->
  {% if header_html != '' %}
    <div class="page-width">
      {{ header_html }}
    </div>
  {% endif %}
  <div
    class="page-width article-{{ section.id }}__layout"
    style="--aside-w: {{ section.settings.aside_width_percent | default: 28 }}%;"
  >
    <div class="article-{{ section.id }}__main">
      {% if hero_html != '' %}
        <div class="">
          {{ hero_html }}
        </div>
      {% endif %}

      <div
        class="article-template__content rte"
        {% if content_block %}
          {{- content_block.shopify_attributes -}}
        {% endif %}
      >
        {{ article.content }}
      </div>

      {%- if section.settings.show_print_button -%}
        {%- if blog.handle == 'recipes' or section.settings.always_show_print -%}
          <div class="article-{{ section.id }}__print">
            <button type="button" class="button button--primary" onclick="window.print()">Print Recipe</button>
          </div>
        {%- endif -%}
      {%- endif -%}

      {%- if share_block -%}
        {%- assign share_url = request.origin | append: article.url -%}
        {%- assign share_img = article.image | default: blank -%}

        <div class="article-{{ section.id }}__share-wrap" {{ share_block.shopify_attributes }}>
          <div class="article-{{ section.id }}__share-title">
            {{ share_block.settings.share_label | default: 'SHARE' }}
          </div>

          <div class="article-{{ section.id }}__share-icons">
            {%- if section.settings.share_show_fb -%}
              <a
                class="share-custom-link"
                target="_blank"
                rel="noopener nofollow"
                href="https://www.facebook.com/sharer/sharer.php?u={{ share_url | url_encode }}"
                aria-label="Share on Facebook"
              >
                <span class="svg-wrapper">{{ 'icon-facebook.svg' | inline_asset_content }}</span>
              </a>
            {%- endif -%}

            {%- if section.settings.share_show_x -%}
              <a
                class="share-custom-link"
                target="_blank"
                rel="noopener nofollow"
                href="https://twitter.com/intent/tweet?url={{ share_url | url_encode }}&text={{ article.title | url_param_escape }}"
                aria-label="Share on X"
              >
                <span class="svg-wrapper">{{ 'icon-twitter.svg' | inline_asset_content }}</span>
              </a>
            {%- endif -%}

            {%- if section.settings.share_show_pin and share_img -%}
              <a
                class="share-custom-link"
                target="_blank"
                rel="noopener nofollow"
                href="https://pinterest.com/pin/create/button/?url={{ share_url | url_encode }}&media={{ share_img | image_url: width: 1200 | url_encode }}&description={{ article.title | url_param_escape }}"
                aria-label="Share on Pinterest"
              >
                <span class="svg-wrapper">{{ 'icon-pinterest.svg' | inline_asset_content }}</span>
              </a>
            {%- endif -%}

            {%- comment -%}
              Optional extra icons defined as blocks (upload an image or paste inline SVG)
            {%- endcomment -%}
            {%- for b in section.blocks -%}
              {%- if b.type == 'share_custom' and b.settings.url != blank -%}
                <a
                  class="share-custom-link"
                  target="_blank"
                  rel="noopener"
                  href="{{ b.settings.url }}"
                  aria-label="{{ b.settings.label | default: 'Share' }}"
                >
                  {%- if b.settings.icon_svg != blank -%}
                    <span class="svg-wrapper">{{ b.settings.icon_svg }}</span>
                  {%- elsif b.settings.icon_image != blank -%}
                    {{
                      b.settings.icon_image
                      | image_url: width: 28
                      | image_tag: class: 'share-custom-icon', alt: b.settings.label
                    }}
                  {%- else -%}
                    {{ b.settings.label | escape }}
                  {%- endif -%}
                </a>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}

      {%- assign prev_url = '' -%}
      {%- assign next_url = '' -%}
      {%- assign found_current = false -%}
      {%- for a in blog.articles -%}
        {%- if found_current -%}
          {%- assign prev_url = a.url -%}
          {%- break -%}
        {%- endif -%}
        {%- if a.id == article.id -%}
          {%- assign found_current = true -%}
        {%- else -%}
          {%- assign next_url = a.url -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if section.settings.show_prev_next -%}
        <nav class="article-{{ section.id }}__pager" aria-label="Article pagination">
          {%- if prev_url != '' -%}
            <span>
              <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                <path d="M13 5L8 10L13 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
              <a href="{{ prev_url }}"> Older post</a>
            </span>
          {%- else -%}
            <span></span>
          {%- endif -%}
          {%- if next_url != '' -%}
            <span class="right inline-icon--wrapper icon--right">
              <a href="{{ next_url }}">Newer post</a>
              <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                <path d="M8 5L13 10L8 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </span>
          {%- endif -%}
        </nav>
      {%- endif -%}
    </div>

    {%- if aside_enabled -%}
      {{ recent_aside }}
    {%- endif -%}
  </div>

  {%- comment -%} Back to blog (kept as in Dawn) {%- endcomment -%}
  {% if section.settings.show_back_to_blog %}
    <div class="article-template__back element-margin-top center">
      <a href="{{ blog.url }}" class="article-template__link link animate-arrow">
        <span class="icon-wrap"
          ><span class="svg-wrapper">{{ 'icon-arrow.svg' | inline_asset_content }}</span></span
        >
        {{ 'blogs.article.back_to_blog' | t: title: blog.title | escape }}
      </a>
    </div>
  {% endif %}

  {%- if blog.comments_enabled? -%}
    {{- '' -}}
    {# ——— Your existing comments block remains unchanged (copiado del original) ——— #}
  {%- endif -%}
</article>

<script type="application/ld+json">
  {{ article | structured_data }}
</script>

{% schema %}
{
  "name": "t:sections.main-article.name",
  "tag": "section",
  "class": "section",
  "blocks": [
    { "type": "@app" },
    {
      "type": "featured_image",
      "name": "t:sections.main-article.blocks.featured_image.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "image_height",
          "options": [
            {
              "value": "adapt",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__1.label"
            },
            {
              "value": "small",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__2.label"
            },
            {
              "value": "medium",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__3.label"
            },
            {
              "value": "large",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__4.label"
            }
          ],
          "default": "adapt",
          "label": "t:sections.main-article.blocks.featured_image.settings.image_height.label"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.main-article.blocks.title.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "blog_show_date",
          "default": true,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_date.label"
        },
        {
          "type": "checkbox",
          "id": "blog_show_author",
          "default": false,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_author.label"
        }
      ]
    },
    { "type": "content", "name": "t:sections.main-article.blocks.content.name", "limit": 1 },
    {
      "type": "share",
      "name": "t:sections.main-article.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "t:sections.main-article.blocks.share.settings.text.label",
          "default": "SHARE"
        }
      ]
    },
    {
      "type": "share_custom",
      "name": "Custom share link",
      "settings": [
        { "type": "text", "id": "label", "label": "Label", "default": "Instagram" },
        { "type": "url", "id": "url", "label": "URL" },
        { "type": "textarea", "id": "icon_svg", "label": "Inline SVG (optional)" },
        { "type": "image_picker", "id": "icon_image", "label": "Icon image (optional)" }
      ]
    }
  ],
  "settings": [
    { "type": "header", "content": "Layout" },
    { "type": "checkbox", "id": "show_back_to_blog", "label": "Show “Back to blog” link", "default": false },
    { "type": "checkbox", "id": "aside_enabled", "label": "Show Recent articles sidebar", "default": true },
    { "type": "text", "id": "aside_title", "label": "Sidebar title", "default": "Recent articles" },
    {
      "type": "range",
      "id": "aside_count",
      "label": "Recent articles to show",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "aside_width_percent",
      "label": "Sidebar width (%)",
      "min": 20,
      "max": 40,
      "step": 1,
      "default": 28
    },

    { "type": "header", "content": "Recipe options" },
    { "type": "checkbox", "id": "show_print_button", "label": "Show Print button for recipes", "default": true },
    {
      "type": "checkbox",
      "id": "always_show_print",
      "label": "Always show Print button (override blog check)",
      "default": false
    },

    { "type": "header", "content": "Share & Pager" },
    { "type": "header", "content": "Share icons" },
    { "type": "checkbox", "id": "share_show_fb", "label": "Show Facebook", "default": true },
    { "type": "checkbox", "id": "share_show_x", "label": "Show X (Twitter)", "default": true },
    { "type": "checkbox", "id": "share_show_pin", "label": "Show Pinterest", "default": true },
    { "type": "checkbox", "id": "show_prev_next", "label": "Show Older/Newer post pagination", "default": true },

    { "type": "header", "content": "Padding" },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ]
}
{% endschema %}
