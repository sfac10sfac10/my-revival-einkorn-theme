{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% assign per_page = section.settings.articles_per_page %}
{% if section.settings.blog_style == 'recipes' and section.settings.recipes_show_all %}
  {% assign per_page = 200 %}
{% endif %}

{% if section.settings.blog_style == 'news' and section.settings.news_sidebar_enabled %}
  {% capture news_aside %}
    <aside class="news-aside" aria-labelledby="news-aside-title-{{ section.id }}">
      <h3 id="news-aside-title-{{ section.id }}" class="news-aside__title">{{ section.settings.news_sidebar_title }}</h3>
      <ul class="news-aside__list" role="list">
        {% for a in blog.articles limit: section.settings.news_sidebar_count %}
          <li class="news-aside__item">
            <a href="{{ a.url }}" class="news-aside__link">{{ a.title }}</a>
            <span class="news-aside__date">{{ a.published_at | time_tag: format: 'date' }}</span>
          </li>
        {% endfor %}
      </ul>
    </aside>
  {% endcapture %}
{% endif %}

{%- paginate blog.articles by per_page -%}
  <div
    class="main-blog page-width section-{{ section.id }}-padding"
    data-variant="{{ section.settings.blog_style }}"
    data-section-id="{{ section.id }}"
  >
    <h1 class="title--primary{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
      {{ blog.title | escape }}
    </h1>

    {% if section.settings.blog_style == 'news' %}
      <div
        class="news-layout"
        data-variant="news"
        data-section-id="{{ section.id }}"
        style="--news-date-col: {{ section.settings.news_date_col_width }}%; --news-aside-w: {{ section.settings.news_aside_width }}%;"
      >
        <div class="news-main">
          {%- for article in blog.articles -%}
            <article class="news-item">
              <div class="news-date">
                {{ article.published_at | time_tag: format: 'date' }}
              </div>
              <div class="news-content">
                {%-
                  render 'article-card',
                  article: article,
                  media_height: 'adapt',
                  media_aspect_ratio: article.image.aspect_ratio,
                  show_image: section.settings.show_image,
                  show_date: false,  /* date is shown in left column */
                  show_author: section.settings.show_author,
                  show_excerpt: true,
                  title_truncate: false,
                  show_read_more: section.settings.show_read_more
                -%}
              </div>
            </article>
          {%- endfor -%}
        </div>

        {%- if section.settings.news_sidebar_enabled -%}
          {{ news_aside }}
        {%- endif -%}
      </div>
    {% else %}
      <div class="blog-articles {% if section.settings.layout == 'collage' %}blog-articles--collage{% endif %}">
        {%- for article in blog.articles -%}
          <div
            class="blog-articles__article article{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
            {% if settings.animations_reveal_on_scroll %}
              data-cascade
              style="--animation-order: {{ forloop.index }};"
            {% endif %}
          >
            {%-
              render 'article-card',
              article: article,
              media_height: section.settings.image_height,
              media_aspect_ratio: article.image.aspect_ratio,
              show_image: section.settings.show_image,
              show_date: section.settings.show_date,
              show_author: section.settings.show_author,
              show_excerpt: section.settings.blog_style != 'recipes',
              show_read_more: section.settings.show_read_more
            -%}
          </div>
        {%- endfor -%}
      </div>
    {% endif %}

    {%- if paginate.pages > 1 -%}
      {%- unless section.settings.blog_style == 'recipes' and section.settings.recipes_show_all -%}
        {%- render 'pagination', paginate: paginate -%}
      {%- endunless -%}
    {%- endif -%}
  </div>

  <style>
    /* ===== Scoped blog styles by variant (recipes / news) ===== */
    /* Scoped with data-section-id to avoid leaking styles to other pages */

    /* ---------- Recipes variant ---------- */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"]{
        padding: 0;
      }

    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] h1{
      padding: 20px 0 30px;
      margin: 20px auto 30px;
      border-bottom: 1px solid #cdcdcd;
      text-align: center;
      font-weight: 600;
      font-size: clamp(32px, 6vw, 56px);
      max-width: min(1660px, 90vw);
    }

    @media (min-width: 750px){
      .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] h1{
        padding: 50px 0 70px;
        margin: 50px auto 70px;
      }
    }

    @media (min-width: 990px){
      .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"]{
        width: 80%;
        max-width: 1660px;
      }
    }

    /* Hide excerpts in cards for Recipes (handled also via show_excerpt=false) */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .article-card__excerpt{
      display: none;
    }

    /* Card title + inline “Read more” (the pseudo-element is inside the <a>, so it's clickable) */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .card__heading{
      font-weight: 600;
      margin-bottom: .25rem;
    }

    /* Remove default underline on the title link when hovering (Dawn's underline-links-hover) */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .underline-links-hover .card__heading a:hover,
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .underline-links-hover .card__heading a:focus {
      text-decoration: none !important;
    }

    /* On hover, emphasize the Read more underline (thicker/darker) */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] h3:hover::after{
      border-bottom-width: 2px;
      border-bottom-color: #222; /* slightly darker for emphasis */
    }

    /* Rounded image containers with dark background (like the reference) */
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .article-card__image-wrapper,
    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .card__inner{
      border-radius: 12px;
      background: #000;
      overflow: hidden;
    }

    .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .blog-articles{
      gap: 32px 50px; /* row-gap / column-gap */
      max-width: min(1660px, 90vw);
      margin-inline: auto;
    }

    /* Force 2 columns on large screens for Recipes */
    @media (min-width: 990px){
      .main-blog[data-variant="recipes"][data-section-id="{{ section.id }}"] .blog-articles{
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    /* Disable Dawn's media hover zoom for blog cards (all variants in this section) */
    .main-blog[data-section-id="{{ section.id }}"][data-variant="recipes"] .media--hover-effect > img,
    .main-blog[data-section-id="{{ section.id }}"][data-variant="news"] .media--hover-effect > img{
      transform: none !important;
      transition: none !important;
    }
    .main-blog[data-section-id="{{ section.id }}"][data-variant="recipes"] .card:hover .media--hover-effect > img,
    .main-blog[data-section-id="{{ section.id }}"][data-variant="news"] .card:hover .media--hover-effect > img{
      transform: none !important;
    }

    /* ---------- News variant (2 columns ≥750px; mobile: single column, no sidebar) ---------- */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"]{
      width: 90%;
      padding: 0;
    }

    /* Title spacing similar to the reference */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] h1{
      padding: 20px 0 30px;
      margin: 20px auto 30px;
      border-bottom: 1px solid #cdcdcd;
      text-align: center;
      font-weight: 600;
      font-size: clamp(32px, 6vw, 56px);
      max-width: min(1660px, 90vw);
    }
    @media (min-width: 750px){
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] h1{
        padding: 50px 0 70px;
        margin: 50px auto 70px;
      }
    }
    @media (min-width: 990px){
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"]{
        width: 80%;
        max-width: 1660px;
      }
    }

    /* Grid wrapper: main + aside (aside hidden on mobile) */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-layout{
      display: grid;
      gap: 32px;
    }
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside{ display: none; }
    @media (min-width: 750px){
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-layout{
        grid-template-columns: minmax(0, 1fr) var(--news-aside-w, 28%);
        align-items: start;
      }
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside{ display: block; }
    }

    /* Main list */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-main{
      display: grid;
      gap: 56px;
    }

    /* Each article row: date left, content right on ≥750px; stack on mobile */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-item{
      display: grid;
      gap: 16px;
      border-bottom: 1px solid #e6e6e6;
      padding-bottom: 28px;
    }
    @media (min-width: 750px){
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-main{
        padding-left: 20px;
      }
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-item{
        grid-template-columns: var(--news-date-col, 12%) 1fr;
        gap: 24px;
      }
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-date{
        padding-top: 6px;
        color: rgba(55,55,55,.65);
        font-size: 12px;
      }
    }
    @media (max-width: 749.98px){
      .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-date{
        order: -1;
        margin-bottom: 8px;
        color: rgba(55,55,55,.65);
        font-size: 12px;
      }
    }

    /* Sidebar: Recent articles */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__title{
      font-weight: 700;
      margin: 0 0 12px;
    }
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__list{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 20px;
    }
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__item{
      border-top: 1px solid #e6e6e6;
      padding-top: 16px;
    }

    /* Sidebar links: inherit text color and underline on hover only */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__link{
      color: rgba(55,55,55,1);
      opacity: 1;
      text-decoration: none;
    }
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__link:hover{
      text-decoration: underline;
    }
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .news-aside__date{
      display: block;
      margin-top: 6px;
      color: rgba(55,55,55,.6);
      font-size: .9em;
    }

    /* --- News: image corners & natural ratio (media_height:'adapt') --- */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .article-card__image-wrapper,
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .card__inner{
      border-radius: 12px;
      overflow: hidden;
    }

    /* Disable Dawn's media hover zoom for News (and keep the Recipes rule as you already have) */
    .main-blog[data-section-id="{{ section.id }}"][data-variant="news"] .media--hover-effect > img{
      transform: none !important;
      transition: none !important;
    }
    .main-blog[data-section-id="{{ section.id }}"][data-variant="news"] .card:hover .media--hover-effect > img{
      transform: none !important;
    }

    /* News: stronger titles and no truncation (handled in snippet) */
    .main-blog[data-variant="news"][data-section-id="{{ section.id }}"] .card__heading{
      font-weight: 700;
    }

    /* Read more block: thin underline, thicker on hover */
    .main-blog[data-section-id="{{ section.id }}"] .article-card__readmore{
      margin-top: 8px;
    }
    .main-blog[data-section-id="{{ section.id }}"] .read-more-link{
      color: inherit;
      font-weight:600;
      text-decoration: none;
      border-bottom: 1px solid #373737;
    }
    .main-blog[data-section-id="{{ section.id }}"] .read-more-link:hover{
      border-bottom: 2px solid #373737;
    }

    /* Kill the stretched link overlay only in this section for Recipes & News.
     Otherwise it sits above everything and swallows hover events. */
    .main-blog[data-section-id="{{ section.id }}"][data-variant="news"] .card .full-unstyled-link::after,
    .main-blog[data-section-id="{{ section.id }}"][data-variant="recipes"] .card .full-unstyled-link::after{
      content: none !important;
    }

    .main-blog[data-section-id="{{ section.id }}"] .article-card__image-hit{
      position: absolute;
      inset: 0;
      z-index: 1;
      /* optional: show hand cursor explicitly */
      cursor: pointer;
    }

    /* --- Never underline the title (both link:hover and card:hover) --- */
    .main-blog[data-section-id="{{ section.id }}"] .underline-links-hover .card__heading a:hover,
    .main-blog[data-section-id="{{ section.id }}"] .underline-links-hover .card__heading a:focus,
    .main-blog[data-section-id="{{ section.id }}"] .card:hover .card__heading a,
    .main-blog[data-section-id="{{ section.id }}"] .card:focus-within .card__heading a{
      text-decoration: none !important;
    }

    /* Safety reset */
    .main-blog[data-section-id="{{ section.id }}"] p:last-child{ margin-bottom: 0; }

    .content-for-layout {
      color: #373737;
    }
  </style>
{%- endpaginate -%}

{% schema %}
{
  "name": "t:sections.main-blog.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "grid",
          "label": "t:sections.main-blog.settings.layout.options__1.label"
        },
        {
          "value": "collage",
          "label": "t:sections.main-blog.settings.layout.options__2.label"
        }
      ],
      "default": "collage",
      "label": "t:sections.main-blog.settings.layout.label"
    },
    {
      "type": "select",
      "id": "blog_style",
      "label": "Style",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "recipes", "label": "Recipes" },
        { "value": "news", "label": "News" }
      ]
    },
    {
      "type": "range",
      "id": "articles_per_page",
      "label": "Articles per page (Default/News)",
      "min": 3,
      "max": 50,
      "step": 1,
      "default": 12
    },
    { "type": "checkbox", "id": "recipes_show_all", "label": "Show all articles on one page", "default": true },
    { "type": "checkbox", "id": "show_read_more", "label": "Show “Read more” link on cards", "default": true },
    { "type": "header", "content": "News options" },
    { "type": "checkbox", "id": "news_sidebar_enabled", "label": "Show sidebar (Recent articles)", "default": true },
    { "type": "text", "id": "news_sidebar_title", "label": "Sidebar title", "default": "Recent articles" },
    {
      "type": "range",
      "id": "news_sidebar_count",
      "label": "Recent articles to show",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "news_date_col_width",
      "label": "Date column width (%)",
      "min": 8,
      "max": 20,
      "step": 1,
      "default": 12
    },
    {
      "type": "range",
      "id": "news_aside_width",
      "label": "Sidebar width (%)",
      "min": 20,
      "max": 40,
      "step": 1,
      "default": 28
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "default": true,
      "label": "t:sections.main-blog.settings.show_image.label"
    },
    {
      "type": "select",
      "id": "image_height",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.main-blog.settings.image_height.options__1.label"
        },
        {
          "value": "small",
          "label": "t:sections.main-blog.settings.image_height.options__2.label"
        },
        {
          "value": "medium",
          "label": "t:sections.main-blog.settings.image_height.options__3.label"
        },
        {
          "value": "large",
          "label": "t:sections.main-blog.settings.image_height.options__4.label"
        }
      ],
      "default": "medium",
      "label": "t:sections.main-blog.settings.image_height.label"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "default": true,
      "label": "t:sections.main-blog.settings.show_date.label"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "default": false,
      "label": "t:sections.main-blog.settings.show_author.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
